---
- hosts: bootstrap
  become: yes
  tasks:
  - name: ceph orch host add nodeXXX
    ansible.builtin.shell:
      cmd: ceph orch host add {{ item }}
    loop: "{{ attached_node }}"

  - name: ceph orch host ls
    ansible.builtin.shell:
      cmd: ceph orch host ls
    register: details
  - debug: msg="{{ details.stdout_lines }}"

  - name: ceph orch apply mon xxxxxxx
    ansible.builtin.shell:
      cmd: ceph orch apply mon {{ inventory_hostname }}{% for host in attached_node_mon %},{{ host }}{% endfor %}
    register: details
  - debug: msg="{{ details.stdout_lines }}"

  - name: ceph -s
    ansible.builtin.shell:
      cmd: ceph -s
    register: details
  - debug: msg="{{ details.stdout_lines }}"

  - name: ceph orch apply mgr xxxxxxx
    ansible.builtin.shell:
      cmd: ceph orch apply mgr {{ inventory_hostname }}{% for host in attached_node_mgr %},{{ host }}{% endfor %}
    register: details
  - debug: msg="{{ details.stdout_lines }}"

  - name: ceph -s
    ansible.builtin.shell:
      cmd: ceph -s
    register: details
  - debug: msg="{{ details.stdout_lines }}"


  - name: pause for {{ wait_seconds | int }} second(s)
    ansible.builtin.pause:
      seconds: "{{ wait_seconds | int }}"

  - name: ceph orch host add nodeXXX
    ansible.builtin.shell: "{{ item}}"
    loop: "{{ attached_node_diag }}"
    register: details

  - name: Debug Msg
    debug:
        msg="{{ item.stdout_lines }}"
    loop: "{{ details.results }}"


