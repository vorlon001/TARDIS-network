

  - name: ceph orch host add nodeXXX
    ansible.builtin.shell:
      cmd: ceph orch host add {{ item }}
    loop: "{{ attached_node }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: ceph orch host ls
    ansible.builtin.shell:
      cmd: ceph orch host ls
    register: details
  - debug:
      msg:
        cmd: "{{ details.cmd }}"
        stdout_lines: "{{ details.stdout_lines }}"
        stderr_lines:  "{{ details.stderr_lines }}"

  - name: ceph orch apply mon xxxxxxx
    ansible.builtin.shell:
      cmd: ceph orch apply mon {{ inventory_hostname }}{% for host in attached_node_mon %},{{ host }}{% endfor %}
    register: details
  - debug:
      msg:
        cmd: "{{ details.cmd }}"
        stdout_lines: "{{ details.stdout_lines }}"
        stderr_lines:  "{{ details.stderr_lines }}"


  - name: ceph orch apply mds nodeXXX
    ansible.builtin.shell:
      cmd: ceph orch apply mds {{ item }}
    loop: "{{ attached_node_mds }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: ceph -s
    ansible.builtin.shell:
      cmd: ceph -s
    register: details
  - debug:
      msg:
        cmd: "{{ details.cmd }}"
        stdout_lines: "{{ details.stdout_lines }}"
        stderr_lines:  "{{ details.stderr_lines }}"

  - name: ceph orch apply mgr xxxxxxx
    ansible.builtin.shell:
      cmd: ceph orch apply mgr {{ inventory_hostname }}{% for host in attached_node_mgr %},{{ host }}{% endfor %}
    register: details
  - debug:
      msg:
        cmd: "{{ details.cmd }}"
        stdout_lines: "{{ details.stdout_lines }}"
        stderr_lines:  "{{ details.stderr_lines }}"

  - name: ceph -s
    ansible.builtin.shell:
      cmd: ceph -s
    register: details
  - debug:
      msg:
        cmd: "{{ details.cmd }}"
        stdout_lines: "{{ details.stdout_lines }}"
        stderr_lines:  "{{ details.stderr_lines }}"


  - name: pause for {{ wait_seconds | int }} second(s)
    ansible.builtin.pause:
      seconds: "{{ wait_seconds | int }}"

  - name: ceph attached node diag
    ansible.builtin.shell: "{{ item}}"
    loop: "{{ attached_node_diag }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"
