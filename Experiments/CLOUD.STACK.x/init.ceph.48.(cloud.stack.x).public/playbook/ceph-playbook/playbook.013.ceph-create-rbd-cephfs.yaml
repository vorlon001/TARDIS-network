  - name: ceph orch host label add ... rgw
    ansible.builtin.shell: "ceph orch host label add  {{ item.name }} rgw"
    loop: "{{ ceph_osd }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: ceph osd pool create .... .... ....
    ansible.builtin.shell:
      cmd: ceph osd pool create {{ item.name }} {{ item.pg_num_1 }} {{ item.pg_num_1 }}
    loop: "{{ ceph_rbd }}"
  - name: pause for {{ wait_seconds | int }} second(s)
    ansible.builtin.pause:
      seconds: "{{ wait_seconds | int }}"

  - name: ceph osd pool ls
    ansible.builtin.shell:
      cmd: ceph osd pool ls
    register: details
  - debug:
      msg:
        cmd: "{{ details.cmd }}"
        stdout_lines: "{{ details.stdout_lines }}"
        stderr_lines:  "{{ details.stderr_lines }}"

  - name: ceph osd pool application enable ..... rbd
    ansible.builtin.shell:
      cmd: ceph osd pool application enable {{ item.name }} rbd
    loop: "{{ ceph_rbd }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: pause for {{ wait_seconds | int }} second(s)
    ansible.builtin.pause:
      seconds: "{{ wait_seconds | int }}"

  - name: ceph auth list
    ansible.builtin.shell:
      cmd: ceph auth list
    register: details
  - debug:
      msg:
        cmd: "{{ details.cmd }}"
        stdout_lines: "{{ details.stdout_lines }}"
        stderr_lines:  "{{ details.stderr_lines }}"

  - name: ceph auth get client.admin
    ansible.builtin.shell:
      cmd: ceph auth get client.admin
    register: details
  - debug:
      msg:
        cmd: "{{ details.cmd }}"
        stdout_lines: "{{ details.stdout_lines }}"
        stderr_lines:  "{{ details.stderr_lines }}"

  - name: ceph auth get-or-create client.....
    ansible.builtin.shell:
      cmd: ceph auth get-or-create client.{{ item.name }}
    loop: "{{ ceph_rbd }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: ceph auth caps client..... mon 'allow r' osd 'allow rwx pool=....'
    ansible.builtin.shell:
      cmd: ceph auth caps client.{{ item.name }} mon 'allow r' osd 'allow rwx pool={{ item.name }}'
    loop: "{{ ceph_rbd }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: ceph auth get client.....
    ansible.builtin.shell:
      cmd: ceph auth get client.{{ item.name }}
    loop: "{{ ceph_rbd }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: ceph fs volume create ....
    ansible.builtin.shell:
      cmd: ceph fs volume create {{ item.name }}
    loop: "{{ ceph_cephfs }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: ceph auth get-or-create client...... mon 'allow r' osd 'allow rwx pool=........'
    ansible.builtin.shell:
      cmd: ceph auth get-or-create client.{{ item.name }} mon 'allow r' osd 'allow rwx pool={{ item.name }}'
    loop: "{{ ceph_cephfs }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: ceph auth get client.....
    ansible.builtin.shell:
      cmd: ceph auth get client.{{ item.name }}
    loop: "{{ ceph_cephfs }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: ceph auth get client..... -o ~/ceph.client.......keyring
    ansible.builtin.shell:
      cmd: ceph auth get client.{{ item.name }} -o ~/ceph.client.{{ item.name }}.keyring
    loop: "{{ ceph_cephfs }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

  - name: ceph fs ls
    ansible.builtin.shell:
      cmd: ceph fs ls
    loop: "{{ ceph_cephfs }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"


  - name: ceph auth get client..... -o ~/ceph.client.....keyring
    ansible.builtin.shell:
      cmd: ceph auth get client.{{ item.name }} -o ~/ceph.client.{{ item.name }}.keyring
    loop: "{{ ceph_rbd }}"
    register: details
  - name: Debug Msg
    debug:
        msg:
          cmd: "{{ item.cmd }}"
          stdout_lines: "{{ item.stdout_lines }}"
          stderr_lines:  "{{ item.stderr_lines }}"
    loop: "{{ details.results }}"

