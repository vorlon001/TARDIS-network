{"payload":{"allShortcutsEnabled":false,"fileTree":{"docs":{"items":[{"name":"COPYING.docs","path":"docs/COPYING.docs","contentType":"file"},{"name":"amd_sev_snp.md","path":"docs/amd_sev_snp.md","contentType":"file"},{"name":"api.md","path":"docs/api.md","contentType":"file"},{"name":"balloon.md","path":"docs/balloon.md","contentType":"file"},{"name":"building.md","path":"docs/building.md","contentType":"file"},{"name":"coverage.md","path":"docs/coverage.md","contentType":"file"},{"name":"cpu.md","path":"docs/cpu.md","contentType":"file"},{"name":"custom-image.md","path":"docs/custom-image.md","contentType":"file"},{"name":"debug-port.md","path":"docs/debug-port.md","contentType":"file"},{"name":"device_model.md","path":"docs/device_model.md","contentType":"file"},{"name":"fs.md","path":"docs/fs.md","contentType":"file"},{"name":"fuzzing.md","path":"docs/fuzzing.md","contentType":"file"},{"name":"gdb.md","path":"docs/gdb.md","contentType":"file"},{"name":"heap-profiling.md","path":"docs/heap-profiling.md","contentType":"file"},{"name":"hotplug.md","path":"docs/hotplug.md","contentType":"file"},{"name":"intel_sgx.md","path":"docs/intel_sgx.md","contentType":"file"},{"name":"intel_tdx.md","path":"docs/intel_tdx.md","contentType":"file"},{"name":"io_throttling.md","path":"docs/io_throttling.md","contentType":"file"},{"name":"iommu.md","path":"docs/iommu.md","contentType":"file"},{"name":"live_migration.md","path":"docs/live_migration.md","contentType":"file"},{"name":"logging.md","path":"docs/logging.md","contentType":"file"},{"name":"macvtap-bridge.md","path":"docs/macvtap-bridge.md","contentType":"file"},{"name":"memory.md","path":"docs/memory.md","contentType":"file"},{"name":"mshv.md","path":"docs/mshv.md","contentType":"file"},{"name":"performance_metrics.md","path":"docs/performance_metrics.md","contentType":"file"},{"name":"profiling.md","path":"docs/profiling.md","contentType":"file"},{"name":"releases.md","path":"docs/releases.md","contentType":"file"},{"name":"seccomp.md","path":"docs/seccomp.md","contentType":"file"},{"name":"snapshot_restore.md","path":"docs/snapshot_restore.md","contentType":"file"},{"name":"tpm.md","path":"docs/tpm.md","contentType":"file"},{"name":"tracing.md","path":"docs/tracing.md","contentType":"file"},{"name":"uefi.md","path":"docs/uefi.md","contentType":"file"},{"name":"vdpa.md","path":"docs/vdpa.md","contentType":"file"},{"name":"vfio-user.md","path":"docs/vfio-user.md","contentType":"file"},{"name":"vfio.md","path":"docs/vfio.md","contentType":"file"},{"name":"vhost-user-blk-testing.md","path":"docs/vhost-user-blk-testing.md","contentType":"file"},{"name":"vhost-user-net-testing.md","path":"docs/vhost-user-net-testing.md","contentType":"file"},{"name":"virtiofs-root.md","path":"docs/virtiofs-root.md","contentType":"file"},{"name":"vsock.md","path":"docs/vsock.md","contentType":"file"},{"name":"windows.md","path":"docs/windows.md","contentType":"file"}],"totalCount":40},"":{"items":[{"name":".github","path":".github","contentType":"directory"},{"name":"api_client","path":"api_client","contentType":"directory"},{"name":"arch","path":"arch","contentType":"directory"},{"name":"block","path":"block","contentType":"directory"},{"name":"devices","path":"devices","contentType":"directory"},{"name":"docs","path":"docs","contentType":"directory"},{"name":"event_monitor","path":"event_monitor","contentType":"directory"},{"name":"fuzz","path":"fuzz","contentType":"directory"},{"name":"hypervisor","path":"hypervisor","contentType":"directory"},{"name":"net_gen","path":"net_gen","contentType":"directory"},{"name":"net_util","path":"net_util","contentType":"directory"},{"name":"option_parser","path":"option_parser","contentType":"directory"},{"name":"pci","path":"pci","contentType":"directory"},{"name":"performance-metrics","path":"performance-metrics","contentType":"directory"},{"name":"rate_limiter","path":"rate_limiter","contentType":"directory"},{"name":"resources","path":"resources","contentType":"directory"},{"name":"scripts","path":"scripts","contentType":"directory"},{"name":"serial_buffer","path":"serial_buffer","contentType":"directory"},{"name":"src","path":"src","contentType":"directory"},{"name":"test_data","path":"test_data","contentType":"directory"},{"name":"test_infra","path":"test_infra","contentType":"directory"},{"name":"tests","path":"tests","contentType":"directory"},{"name":"tpm","path":"tpm","contentType":"directory"},{"name":"tracer","path":"tracer","contentType":"directory"},{"name":"vhost_user_block","path":"vhost_user_block","contentType":"directory"},{"name":"vhost_user_net","path":"vhost_user_net","contentType":"directory"},{"name":"virtio-devices","path":"virtio-devices","contentType":"directory"},{"name":"vm-allocator","path":"vm-allocator","contentType":"directory"},{"name":"vm-device","path":"vm-device","contentType":"directory"},{"name":"vm-migration","path":"vm-migration","contentType":"directory"},{"name":"vm-virtio","path":"vm-virtio","contentType":"directory"},{"name":"vmm","path":"vmm","contentType":"directory"},{"name":".gitignore","path":".gitignore","contentType":"file"},{"name":".gitlint","path":".gitlint","contentType":"file"},{"name":".rustfmt.toml","path":".rustfmt.toml","contentType":"file"},{"name":".typos.toml","path":".typos.toml","contentType":"file"},{"name":"CODEOWNERS","path":"CODEOWNERS","contentType":"file"},{"name":"CODE_OF_CONDUCT.md","path":"CODE_OF_CONDUCT.md","contentType":"file"},{"name":"CONTRIBUTING.md","path":"CONTRIBUTING.md","contentType":"file"},{"name":"CREDITS.md","path":"CREDITS.md","contentType":"file"},{"name":"Cargo.lock","path":"Cargo.lock","contentType":"file"},{"name":"Cargo.toml","path":"Cargo.toml","contentType":"file"},{"name":"Jenkinsfile","path":"Jenkinsfile","contentType":"file"},{"name":"LICENSE-APACHE","path":"LICENSE-APACHE","contentType":"file"},{"name":"LICENSE-BSD-3-Clause","path":"LICENSE-BSD-3-Clause","contentType":"file"},{"name":"MAINTAINERS.md","path":"MAINTAINERS.md","contentType":"file"},{"name":"README.md","path":"README.md","contentType":"file"},{"name":"build.rs","path":"build.rs","contentType":"file"},{"name":"release-notes.md","path":"release-notes.md","contentType":"file"}],"totalCount":49}},"fileTreeProcessingTime":12.862888,"foldersToFetch":[],"reducedMotionEnabled":null,"repo":{"id":184341774,"defaultBranch":"main","name":"cloud-hypervisor","ownerLogin":"cloud-hypervisor","currentUserCanPush":false,"isFork":false,"isEmpty":false,"createdAt":"2019-04-30T22:49:03.000Z","ownerAvatar":"https://avatars.githubusercontent.com/u/50487650?v=4","public":true,"private":false,"isOrgOwned":true},"symbolsExpanded":false,"treeExpanded":true,"refInfo":{"name":"main","listCacheKey":"v0:1700266483.0","canEdit":false,"refType":"branch","currentOid":"4b87964093dc13b9db043a1c70040ff7d658137d"},"path":"docs/hotplug.md","currentUser":null,"blob":{"rawLines":null,"stylingDirectives":null,"csv":null,"csvError":null,"dependabotInfo":{"showConfigurationBanner":false,"configFilePath":null,"networkDependabotPath":"/cloud-hypervisor/cloud-hypervisor/network/updates","dismissConfigurationNoticePath":"/settings/dismiss-notice/dependabot_configuration_notice","configurationNoticeDismissed":null,"repoAlertsPath":"/cloud-hypervisor/cloud-hypervisor/security/dependabot","repoSecurityAndAnalysisPath":"/cloud-hypervisor/cloud-hypervisor/settings/security_analysis","repoOwnerIsOrg":true,"currentUserCanAdminRepo":false},"displayName":"hotplug.md","displayUrl":"https://github.com/cloud-hypervisor/cloud-hypervisor/blob/main/docs/hotplug.md?raw=true","headerInfo":{"blobSize":"9.25 KB","deleteInfo":{"deleteTooltip":"You must be signed in to make or propose changes"},"editInfo":{"editTooltip":"You must be signed in to make or propose changes"},"ghDesktopPath":"https://desktop.github.com","gitLfsPath":null,"onBranch":true,"shortPath":"abf6ecb","siteNavLoginPath":"/login?return_to=https%3A%2F%2Fgithub.com%2Fcloud-hypervisor%2Fcloud-hypervisor%2Fblob%2Fmain%2Fdocs%2Fhotplug.md","isCSV":false,"isRichtext":true,"toc":[{"level":1,"text":"Cloud Hypervisor Hot Plug","anchor":"cloud-hypervisor-hot-plug","htmlText":"Cloud Hypervisor Hot Plug"},{"level":2,"text":"Kernel support","anchor":"kernel-support","htmlText":"Kernel support"},{"level":2,"text":"CPU Hot Plug","anchor":"cpu-hot-plug","htmlText":"CPU Hot Plug"},{"level":2,"text":"Memory Hot Plug","anchor":"memory-hot-plug","htmlText":"Memory Hot Plug"},{"level":3,"text":"ACPI method","anchor":"acpi-method","htmlText":"ACPI method"},{"level":3,"text":"virtio-mem method","anchor":"virtio-mem-method","htmlText":"virtio-mem method"},{"level":2,"text":"PCI Device Hot Plug","anchor":"pci-device-hot-plug","htmlText":"PCI Device Hot Plug"},{"level":3,"text":"Add VFIO Device","anchor":"add-vfio-device","htmlText":"Add VFIO Device"},{"level":3,"text":"Add Disk Device","anchor":"add-disk-device","htmlText":"Add Disk Device"},{"level":3,"text":"Add Fs Device","anchor":"add-fs-device","htmlText":"Add Fs Device"},{"level":3,"text":"Add Net Device","anchor":"add-net-device","htmlText":"Add Net Device"},{"level":3,"text":"Add Pmem Device","anchor":"add-pmem-device","htmlText":"Add Pmem Device"},{"level":3,"text":"Add Vsock Device","anchor":"add-vsock-device","htmlText":"Add Vsock Device"},{"level":3,"text":"Common Across All PCI Devices","anchor":"common-across-all-pci-devices","htmlText":"Common Across All PCI Devices"},{"level":3,"text":"Remove PCI device","anchor":"remove-pci-device","htmlText":"Remove PCI device"}],"lineInfo":{"truncatedLoc":"250","truncatedSloc":"175"},"mode":"file"},"image":false,"isCodeownersFile":null,"isPlain":false,"isValidLegacyIssueTemplate":false,"issueTemplateHelpUrl":"https://docs.github.com/articles/about-issue-and-pull-request-templates","issueTemplate":null,"discussionTemplate":null,"language":"Markdown","languageID":222,"large":false,"loggedIn":false,"newDiscussionPath":"/cloud-hypervisor/cloud-hypervisor/discussions/new","newIssuePath":"/cloud-hypervisor/cloud-hypervisor/issues/new","planSupportInfo":{"repoIsFork":null,"repoOwnedByCurrentUser":null,"requestFullPath":"/cloud-hypervisor/cloud-hypervisor/blob/main/docs/hotplug.md","showFreeOrgGatedFeatureMessage":null,"showPlanSupportBanner":null,"upgradeDataAttributes":null,"upgradePath":null},"publishBannersInfo":{"dismissActionNoticePath":"/settings/dismiss-notice/publish_action_from_dockerfile","dismissStackNoticePath":"/settings/dismiss-notice/publish_stack_from_file","releasePath":"/cloud-hypervisor/cloud-hypervisor/releases/new?marketplace=true","showPublishActionBanner":false,"showPublishStackBanner":false},"rawBlobUrl":"https://github.com/cloud-hypervisor/cloud-hypervisor/raw/main/docs/hotplug.md","renderImageOrRaw":false,"richText":"<article class=\"markdown-body entry-content container-lg\" itemprop=\"text\"><h1 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-cloud-hypervisor-hot-plug\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#cloud-hypervisor-hot-plug\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Cloud Hypervisor Hot Plug</h1>\n<p dir=\"auto\">Currently Cloud Hypervisor supports hot plugging of CPUs devices (x86 only), PCI devices and memory resizing.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-kernel-support\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#kernel-support\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Kernel support</h2>\n<p dir=\"auto\">For hotplug on Cloud Hypervisor ACPI GED support is needed. This can either be achieved by turning on <code>CONFIG_ACPI_REDUCED_HARDWARE_ONLY</code>\nor by using this kernel patch (available in 5.5-rc1 and later): <a href=\"https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/patch/drivers/acpi/Makefile?id=ac36d37e943635fc072e9d4f47e40a48fbcdb3f0\" rel=\"nofollow\">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/patch/drivers/acpi/Makefile?id=ac36d37e943635fc072e9d4f47e40a48fbcdb3f0</a></p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-cpu-hot-plug\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#cpu-hot-plug\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>CPU Hot Plug</h2>\n<p dir=\"auto\">Extra vCPUs can be added and removed from a running <code>cloud-hypervisor</code> instance. This is controlled by two mechanisms:</p>\n<ol dir=\"auto\">\n<li>Specifying a number of maximum potential vCPUs that is greater than the number of default (boot) vCPUs.</li>\n<li>Making a HTTP API request to the VMM to ask for the additional vCPUs to be added.</li>\n</ol>\n<p dir=\"auto\">To use CPU hotplug start the VM with the number of max vCPUs greater than the number of boot vCPUs, e.g.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ pushd $CLOUDH\n$ sudo setcap cap_net_admin+ep ./cloud-hypervisor/target/release/cloud-hypervisor\n$ ./cloud-hypervisor/target/release/cloud-hypervisor \\\n\t--kernel custom-vmlinux.bin \\\n\t--cmdline &quot;console=ttyS0 console=hvc0 root=/dev/vda1 rw&quot; \\\n\t--disk path=focal-server-cloudimg-amd64.raw \\\n\t--cpus boot=4,max=8 \\\n\t--memory size=1024M \\\n\t--net &quot;tap=,mac=,ip=,mask=&quot; \\\n\t--rng \\\n\t--api-socket=/tmp/ch-socket\n$ popd\"><pre>$ <span class=\"pl-c1\">pushd</span> <span class=\"pl-smi\">$CLOUDH</span>\n$ sudo setcap cap_net_admin+ep ./cloud-hypervisor/target/release/cloud-hypervisor\n$ ./cloud-hypervisor/target/release/cloud-hypervisor \\\n\t--kernel custom-vmlinux.bin \\\n\t--cmdline <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>console=ttyS0 console=hvc0 root=/dev/vda1 rw<span class=\"pl-pds\">\"</span></span> \\\n\t--disk path=focal-server-cloudimg-amd64.raw \\\n\t--cpus boot=4,max=8 \\\n\t--memory size=1024M \\\n\t--net <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tap=,mac=,ip=,mask=<span class=\"pl-pds\">\"</span></span> \\\n\t--rng \\\n\t--api-socket=/tmp/ch-socket\n$ <span class=\"pl-c1\">popd</span></pre></div>\n<p dir=\"auto\">Notice the addition of <code>--api-socket=/tmp/ch-socket</code> and a <code>max</code> parameter on <code>--cpus boot=4,max=8</code>.</p>\n<p dir=\"auto\">To ask the VMM to add additional vCPUs then use the resize API:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket resize --cpus 8\"><pre>./ch-remote --api-socket=/tmp/ch-socket resize --cpus 8</pre></div>\n<p dir=\"auto\">The extra vCPU threads will be created and advertised to the running kernel. The kernel does not bring up the CPUs immediately and instead the user must \"online\" them from inside the VM:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"root@ch-guest ~ # lscpu | grep list:\nOn-line CPU(s) list:             0-3\nOff-line CPU(s) list:            4-7\nroot@ch-guest ~ # echo 1 | tee /sys/devices/system/cpu/cpu[4,5,6,7]/online\n1\nroot@ch-guest ~ # lscpu | grep list:\nOn-line CPU(s) list:             0-7\"><pre>root@ch-guest <span class=\"pl-k\">~</span> <span class=\"pl-c\"><span class=\"pl-c\">#</span> lscpu | grep list:</span>\nOn-line CPU(s) list:             0-3\nOff-line CPU(s) list:            4-7\nroot@ch-guest <span class=\"pl-k\">~</span> <span class=\"pl-c\"><span class=\"pl-c\">#</span> echo 1 | tee /sys/devices/system/cpu/cpu[4,5,6,7]/online</span>\n1\nroot@ch-guest <span class=\"pl-k\">~</span> <span class=\"pl-c\"><span class=\"pl-c\">#</span> lscpu | grep list:</span>\nOn-line CPU(s) list:             0-7</pre></div>\n<p dir=\"auto\">After a reboot the added CPUs will remain.</p>\n<p dir=\"auto\">Removing CPUs works similarly by reducing the number in the \"desired_vcpus\" field of the reisze API. The CPUs will be automatically offlined inside the guest so there is no need to run any commands inside the guest:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket resize --cpus 2\"><pre>./ch-remote --api-socket=/tmp/ch-socket resize --cpus 2</pre></div>\n<p dir=\"auto\">As per adding CPUs to the guest, after a reboot the VM will be running with the reduced number of vCPUs.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-memory-hot-plug\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#memory-hot-plug\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Memory Hot Plug</h2>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-acpi-method\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#acpi-method\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>ACPI method</h3>\n<p dir=\"auto\">Extra memory can be added from a running <code>cloud-hypervisor</code> instance. This is controlled by two mechanisms:</p>\n<ol dir=\"auto\">\n<li>Allocating some of the guest physical address space for hotplug memory.</li>\n<li>Making a HTTP API request to the VMM to ask for a new amount of RAM to be assigned to the VM. In the case of expanding the memory for the VM the new memory will be hotplugged into the running VM, if reducing the size of the memory then change will take effect after the next reboot.</li>\n</ol>\n<p dir=\"auto\">To use memory hotplug start the VM specifying some size RAM in the <code>hotplug_size</code> parameter to the memory configuration. Not all the memory specified in this parameter will be available to hotplug as there are spacing and alignment requirements so it is recommended to make it larger than the hotplug RAM needed.</p>\n<p dir=\"auto\">Because the ACPI method is the default, there is no need to add the extra option <code>hotplug_method=acpi</code>.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ pushd $CLOUDH\n$ sudo setcap cap_net_admin+ep ./cloud-hypervisor/target/release/cloud-hypervisor\n$ ./cloud-hypervisor/target/release/cloud-hypervisor \\\n\t--kernel custom-vmlinux.bin \\\n\t--cmdline &quot;console=ttyS0 console=hvc0 root=/dev/vda1 rw&quot; \\\n\t--disk path=focal-server-cloudimg-amd64.raw \\\n\t--cpus boot=4,max=8 \\\n\t--memory size=1024M,hotplug_size=8192M \\\n\t--net &quot;tap=,mac=,ip=,mask=&quot; \\\n\t--rng \\\n\t--api-socket=/tmp/ch-socket\n$ popd\"><pre>$ <span class=\"pl-c1\">pushd</span> <span class=\"pl-smi\">$CLOUDH</span>\n$ sudo setcap cap_net_admin+ep ./cloud-hypervisor/target/release/cloud-hypervisor\n$ ./cloud-hypervisor/target/release/cloud-hypervisor \\\n\t--kernel custom-vmlinux.bin \\\n\t--cmdline <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>console=ttyS0 console=hvc0 root=/dev/vda1 rw<span class=\"pl-pds\">\"</span></span> \\\n\t--disk path=focal-server-cloudimg-amd64.raw \\\n\t--cpus boot=4,max=8 \\\n\t--memory size=1024M,hotplug_size=8192M \\\n\t--net <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tap=,mac=,ip=,mask=<span class=\"pl-pds\">\"</span></span> \\\n\t--rng \\\n\t--api-socket=/tmp/ch-socket\n$ <span class=\"pl-c1\">popd</span></pre></div>\n<p dir=\"auto\">Before issuing the API request it is necessary to run the following command inside the VM to make it automatically online the added memory:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"root@ch-guest ~ # echo online | sudo tee /sys/devices/system/memory/auto_online_blocks\"><pre>root@ch-guest <span class=\"pl-k\">~</span> <span class=\"pl-c\"><span class=\"pl-c\">#</span> echo online | sudo tee /sys/devices/system/memory/auto_online_blocks</span></pre></div>\n<p dir=\"auto\">To ask the VMM to expand the RAM for the VM:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket resize --memory 3G\"><pre>./ch-remote --api-socket=/tmp/ch-socket resize --memory 3G</pre></div>\n<p dir=\"auto\">The new memory is now available to use inside the VM:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"free -h\n              total        used        free      shared  buff/cache   available\nMem:          3.0Gi        71Mi       2.8Gi       0.0Ki        47Mi       2.8Gi\nSwap:          32Mi          0B        32Mi\"><pre>free -h\n              total        used        free      shared  buff/cache   available\nMem:          3.0Gi        71Mi       2.8Gi       0.0Ki        47Mi       2.8Gi\nSwap:          32Mi          0B        32Mi</pre></div>\n<p dir=\"auto\">Due to guest OS limitations is is necessary to ensure that amount of memory added (between currently assigned RAM and that which is desired) is a multiple of 128MiB.</p>\n<p dir=\"auto\">The same API can also be used to reduce the desired RAM for a VM but the change will not be applied until the VM is rebooted.</p>\n<p dir=\"auto\">Memory and CPU resizing can be combined together into the same HTTP API request.</p>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-virtio-mem-method\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#virtio-mem-method\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>virtio-mem method</h3>\n<p dir=\"auto\">Extra memory can be added and removed from a running Cloud Hypervisor instance. This is controlled by two mechanisms:</p>\n<ol dir=\"auto\">\n<li>Allocating some of the guest physical address space for hotplug memory.</li>\n<li>Making a HTTP API request to the VMM to ask for a new amount of RAM to be assigned to the VM.</li>\n</ol>\n<p dir=\"auto\">To use memory hotplug start the VM specifying some size RAM in the <code>hotplug_size</code> parameter along with <code>hotplug_method=virtio-mem</code> to the memory configuration.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ pushd $CLOUDH\n$ sudo setcap cap_net_admin+ep ./cloud-hypervisor/target/release/cloud-hypervisor\n$ ./cloud-hypervisor/target/release/cloud-hypervisor \\\n\t--kernel custom-vmlinux.bin \\\n\t--cmdline &quot;console=ttyS0 console=hvc0 root=/dev/vda1 rw&quot; \\\n\t--disk path=focal-server-cloudimg-amd64.raw \\\n\t--memory size=1024M,hotplug_size=8192M,hotplug_method=virtio-mem \\\n\t--net &quot;tap=,mac=,ip=,mask=&quot; \\\n\t--api-socket=/tmp/ch-socket\n$ popd\"><pre>$ <span class=\"pl-c1\">pushd</span> <span class=\"pl-smi\">$CLOUDH</span>\n$ sudo setcap cap_net_admin+ep ./cloud-hypervisor/target/release/cloud-hypervisor\n$ ./cloud-hypervisor/target/release/cloud-hypervisor \\\n\t--kernel custom-vmlinux.bin \\\n\t--cmdline <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>console=ttyS0 console=hvc0 root=/dev/vda1 rw<span class=\"pl-pds\">\"</span></span> \\\n\t--disk path=focal-server-cloudimg-amd64.raw \\\n\t--memory size=1024M,hotplug_size=8192M,hotplug_method=virtio-mem \\\n\t--net <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tap=,mac=,ip=,mask=<span class=\"pl-pds\">\"</span></span> \\\n\t--api-socket=/tmp/ch-socket\n$ <span class=\"pl-c1\">popd</span></pre></div>\n<p dir=\"auto\">To ask the VMM to expand the RAM for the VM (request is in bytes):</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket resize --memory 3G\"><pre>./ch-remote --api-socket=/tmp/ch-socket resize --memory 3G</pre></div>\n<p dir=\"auto\">The new memory is now available to use inside the VM:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"free -h\n              total        used        free      shared  buff/cache   available\nMem:          3.0Gi        71Mi       2.8Gi       0.0Ki        47Mi       2.8Gi\nSwap:          32Mi          0B        32Mi\"><pre>free -h\n              total        used        free      shared  buff/cache   available\nMem:          3.0Gi        71Mi       2.8Gi       0.0Ki        47Mi       2.8Gi\nSwap:          32Mi          0B        32Mi</pre></div>\n<p dir=\"auto\">The same API can also be used to reduce the desired RAM for a VM. It is important to note that reducing RAM size might only partially work, as the guest might be using some of it.</p>\n<h2 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-pci-device-hot-plug\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#pci-device-hot-plug\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>PCI Device Hot Plug</h2>\n<p dir=\"auto\">Extra PCI devices can be added and removed from a running <code>cloud-hypervisor</code> instance. This is controlled by making a HTTP API request to the VMM to ask for the additional device to be added, or for the existing device to be removed.</p>\n<p dir=\"auto\">Note: On AArch64 platform, PCI device hotplug can only be achieved using ACPI. Please refer to the <a href=\"/cloud-hypervisor/cloud-hypervisor/blob/main/docs/uefi.md#building-uefi-firmware-for-aarch64\">documentation</a> for more information.</p>\n<p dir=\"auto\">To use PCI device hotplug start the VM with the HTTP server.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ sudo setcap cap_net_admin+ep ./cloud-hypervisor/target/release/cloud-hypervisor\n$ ./cloud-hypervisor/target/release/cloud-hypervisor \\\n\t--kernel custom-vmlinux.bin \\\n\t--cmdline &quot;console=ttyS0 console=hvc0 root=/dev/vda1 rw&quot; \\\n\t--disk path=focal-server-cloudimg-amd64.raw \\\n\t--cpus boot=4 \\\n\t--memory size=1024M \\\n\t--net &quot;tap=,mac=,ip=,mask=&quot; \\\n\t--api-socket=/tmp/ch-socket\"><pre>$ sudo setcap cap_net_admin+ep ./cloud-hypervisor/target/release/cloud-hypervisor\n$ ./cloud-hypervisor/target/release/cloud-hypervisor \\\n\t--kernel custom-vmlinux.bin \\\n\t--cmdline <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>console=ttyS0 console=hvc0 root=/dev/vda1 rw<span class=\"pl-pds\">\"</span></span> \\\n\t--disk path=focal-server-cloudimg-amd64.raw \\\n\t--cpus boot=4 \\\n\t--memory size=1024M \\\n\t--net <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tap=,mac=,ip=,mask=<span class=\"pl-pds\">\"</span></span> \\\n\t--api-socket=/tmp/ch-socket</pre></div>\n<p dir=\"auto\">Notice the addition of <code>--api-socket=/tmp/ch-socket</code>.</p>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-add-vfio-device\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-vfio-device\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Add VFIO Device</h3>\n<p dir=\"auto\">To ask the VMM to add additional VFIO device then use the <code>add-device</code> API.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket add-device path=/sys/bus/pci/devices/0000:01:00.0/\"><pre>./ch-remote --api-socket=/tmp/ch-socket add-device path=/sys/bus/pci/devices/0000:01:00.0/</pre></div>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-add-disk-device\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-disk-device\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Add Disk Device</h3>\n<p dir=\"auto\">To ask the VMM to add additional disk device then use the <code>add-disk</code> API.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket add-disk path=/foo/bar/cloud.img\"><pre>./ch-remote --api-socket=/tmp/ch-socket add-disk path=/foo/bar/cloud.img</pre></div>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-add-fs-device\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-fs-device\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Add Fs Device</h3>\n<p dir=\"auto\">To ask the VMM to add additional fs device then use the <code>add-fs</code> API.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket add-fs tag=myfs,socket=/foo/bar/virtiofs.sock\"><pre>./ch-remote --api-socket=/tmp/ch-socket add-fs tag=myfs,socket=/foo/bar/virtiofs.sock</pre></div>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-add-net-device\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-net-device\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Add Net Device</h3>\n<p dir=\"auto\">To ask the VMM to add additional network device then use the <code>add-net</code> API.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket add-net tap=chtap0\"><pre>./ch-remote --api-socket=/tmp/ch-socket add-net tap=chtap0</pre></div>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-add-pmem-device\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-pmem-device\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Add Pmem Device</h3>\n<p dir=\"auto\">To ask the VMM to add additional PMEM device then use the <code>add-pmem</code> API.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket add-pmem file=/foo/bar.cloud.img\"><pre>./ch-remote --api-socket=/tmp/ch-socket add-pmem file=/foo/bar.cloud.img</pre></div>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-add-vsock-device\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#add-vsock-device\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Add Vsock Device</h3>\n<p dir=\"auto\">To ask the VMM to add additional vsock device then use the <code>add-vsock</code> API.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket add-vsock cid=3,socket=/foo/bar/vsock.sock\"><pre>./ch-remote --api-socket=/tmp/ch-socket add-vsock cid=3,socket=/foo/bar/vsock.sock</pre></div>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-common-across-all-pci-devices\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#common-across-all-pci-devices\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Common Across All PCI Devices</h3>\n<p dir=\"auto\">The extra PCI device will be created and advertised to the running kernel. The new device can be found by checking the list of PCI devices.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"root@ch-guest ~ # lspci\n00:00.0 Host bridge: Intel Corporation Device 0d57\n00:01.0 Unassigned class [ffff]: Red Hat, Inc. Virtio console (rev 01)\n00:02.0 Mass storage controller: Red Hat, Inc. Virtio block device (rev 01)\n00:03.0 Unassigned class [ffff]: Red Hat, Inc. Virtio RNG (rev 01)\"><pre>root@ch-guest <span class=\"pl-k\">~</span> <span class=\"pl-c\"><span class=\"pl-c\">#</span> lspci</span>\n00:00.0 Host bridge: Intel Corporation Device 0d57\n00:01.0 Unassigned class [ffff]: Red Hat, Inc. Virtio console (rev 01)\n00:02.0 Mass storage controller: Red Hat, Inc. Virtio block device (rev 01)\n00:03.0 Unassigned class [ffff]: Red Hat, Inc. Virtio RNG (rev 01)</pre></div>\n<p dir=\"auto\">After a reboot the added PCI device will remain.</p>\n<h3 tabindex=\"-1\" dir=\"auto\"><a id=\"user-content-remove-pci-device\" class=\"anchor\" aria-hidden=\"true\" tabindex=\"-1\" href=\"#remove-pci-device\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z\"></path></svg></a>Remove PCI device</h3>\n<p dir=\"auto\">Removing a PCI device works the same way for all kind of PCI devices. The unique identifier related to the device must be provided. This identifier can be provided by the user when adding the new device, or by default Cloud Hypervisor will assign one.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"./ch-remote --api-socket=/tmp/ch-socket remove-device _disk0\"><pre>./ch-remote --api-socket=/tmp/ch-socket remove-device _disk0</pre></div>\n<p dir=\"auto\">As per adding a PCI device to the guest, after a reboot the VM will be running without the removed PCI device.</p>\n</article>","renderedFileInfo":null,"shortPath":null,"tabSize":8,"topBannersInfo":{"overridingGlobalFundingFile":false,"globalPreferredFundingPath":null,"repoOwner":"cloud-hypervisor","repoName":"cloud-hypervisor","showInvalidCitationWarning":false,"citationHelpUrl":"https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/creating-a-repository-on-github/about-citation-files","showDependabotConfigurationBanner":false,"actionsOnboardingTip":null},"truncated":false,"viewable":true,"workflowRedirectUrl":null,"symbols":{"timedOut":false,"notAnalyzed":false,"symbols":[{"name":"Cloud Hypervisor Hot Plug","kind":"section_1","identStart":2,"identEnd":27,"extentStart":0,"extentEnd":9475,"fullyQualifiedName":"Cloud Hypervisor Hot Plug","identUtf16":{"start":{"lineNumber":0,"utf16Col":2},"end":{"lineNumber":0,"utf16Col":27}},"extentUtf16":{"start":{"lineNumber":0,"utf16Col":0},"end":{"lineNumber":250,"utf16Col":0}}},{"name":"Kernel support","kind":"section_2","identStart":143,"identEnd":157,"extentStart":140,"extentEnd":501,"fullyQualifiedName":"Kernel support","identUtf16":{"start":{"lineNumber":4,"utf16Col":3},"end":{"lineNumber":4,"utf16Col":17}},"extentUtf16":{"start":{"lineNumber":4,"utf16Col":0},"end":{"lineNumber":9,"utf16Col":0}}},{"name":"CPU Hot Plug","kind":"section_2","identStart":504,"identEnd":516,"extentStart":501,"extentEnd":2502,"fullyQualifiedName":"CPU Hot Plug","identUtf16":{"start":{"lineNumber":9,"utf16Col":3},"end":{"lineNumber":9,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":9,"utf16Col":0},"end":{"lineNumber":63,"utf16Col":0}}},{"name":"Memory Hot Plug","kind":"section_2","identStart":2505,"identEnd":2520,"extentStart":2502,"extentEnd":6412,"fullyQualifiedName":"Memory Hot Plug","identUtf16":{"start":{"lineNumber":63,"utf16Col":3},"end":{"lineNumber":63,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":63,"utf16Col":0},"end":{"lineNumber":157,"utf16Col":0}}},{"name":"ACPI method","kind":"section_3","identStart":2526,"identEnd":2537,"extentStart":2522,"extentEnd":4893,"fullyQualifiedName":"ACPI method","identUtf16":{"start":{"lineNumber":65,"utf16Col":4},"end":{"lineNumber":65,"utf16Col":15}},"extentUtf16":{"start":{"lineNumber":65,"utf16Col":0},"end":{"lineNumber":118,"utf16Col":0}}},{"name":"virtio-mem method","kind":"section_3","identStart":4897,"identEnd":4914,"extentStart":4893,"extentEnd":6412,"fullyQualifiedName":"virtio-mem method","identUtf16":{"start":{"lineNumber":118,"utf16Col":4},"end":{"lineNumber":118,"utf16Col":21}},"extentUtf16":{"start":{"lineNumber":118,"utf16Col":0},"end":{"lineNumber":157,"utf16Col":0}}},{"name":"PCI Device Hot Plug","kind":"section_2","identStart":6415,"identEnd":6434,"extentStart":6412,"extentEnd":9475,"fullyQualifiedName":"PCI Device Hot Plug","identUtf16":{"start":{"lineNumber":157,"utf16Col":3},"end":{"lineNumber":157,"utf16Col":22}},"extentUtf16":{"start":{"lineNumber":157,"utf16Col":0},"end":{"lineNumber":250,"utf16Col":0}}},{"name":"Add VFIO Device","kind":"section_3","identStart":7363,"identEnd":7378,"extentStart":7359,"extentEnd":7562,"fullyQualifiedName":"Add VFIO Device","identUtf16":{"start":{"lineNumber":179,"utf16Col":4},"end":{"lineNumber":179,"utf16Col":19}},"extentUtf16":{"start":{"lineNumber":179,"utf16Col":0},"end":{"lineNumber":187,"utf16Col":0}}},{"name":"Add Disk Device","kind":"section_3","identStart":7566,"identEnd":7581,"extentStart":7562,"extentEnd":7745,"fullyQualifiedName":"Add Disk Device","identUtf16":{"start":{"lineNumber":187,"utf16Col":4},"end":{"lineNumber":187,"utf16Col":19}},"extentUtf16":{"start":{"lineNumber":187,"utf16Col":0},"end":{"lineNumber":195,"utf16Col":0}}},{"name":"Add Fs Device","kind":"section_3","identStart":7749,"identEnd":7762,"extentStart":7745,"extentEnd":7935,"fullyQualifiedName":"Add Fs Device","identUtf16":{"start":{"lineNumber":195,"utf16Col":4},"end":{"lineNumber":195,"utf16Col":17}},"extentUtf16":{"start":{"lineNumber":195,"utf16Col":0},"end":{"lineNumber":203,"utf16Col":0}}},{"name":"Add Net Device","kind":"section_3","identStart":7939,"identEnd":7953,"extentStart":7935,"extentEnd":8105,"fullyQualifiedName":"Add Net Device","identUtf16":{"start":{"lineNumber":203,"utf16Col":4},"end":{"lineNumber":203,"utf16Col":18}},"extentUtf16":{"start":{"lineNumber":203,"utf16Col":0},"end":{"lineNumber":211,"utf16Col":0}}},{"name":"Add Pmem Device","kind":"section_3","identStart":8109,"identEnd":8124,"extentStart":8105,"extentEnd":8288,"fullyQualifiedName":"Add Pmem Device","identUtf16":{"start":{"lineNumber":211,"utf16Col":4},"end":{"lineNumber":211,"utf16Col":19}},"extentUtf16":{"start":{"lineNumber":211,"utf16Col":0},"end":{"lineNumber":219,"utf16Col":0}}},{"name":"Add Vsock Device","kind":"section_3","identStart":8292,"identEnd":8308,"extentStart":8288,"extentEnd":8484,"fullyQualifiedName":"Add Vsock Device","identUtf16":{"start":{"lineNumber":219,"utf16Col":4},"end":{"lineNumber":219,"utf16Col":20}},"extentUtf16":{"start":{"lineNumber":219,"utf16Col":0},"end":{"lineNumber":227,"utf16Col":0}}},{"name":"Common Across All PCI Devices","kind":"section_3","identStart":8488,"identEnd":8517,"extentStart":8484,"extentEnd":9013,"fullyQualifiedName":"Common Across All PCI Devices","identUtf16":{"start":{"lineNumber":227,"utf16Col":4},"end":{"lineNumber":227,"utf16Col":33}},"extentUtf16":{"start":{"lineNumber":227,"utf16Col":0},"end":{"lineNumber":241,"utf16Col":0}}},{"name":"Remove PCI device","kind":"section_3","identStart":9017,"identEnd":9034,"extentStart":9013,"extentEnd":9475,"fullyQualifiedName":"Remove PCI device","identUtf16":{"start":{"lineNumber":241,"utf16Col":4},"end":{"lineNumber":241,"utf16Col":21}},"extentUtf16":{"start":{"lineNumber":241,"utf16Col":0},"end":{"lineNumber":250,"utf16Col":0}}}]}},"copilotInfo":null,"copilotAccessAllowed":false,"csrf_tokens":{"/cloud-hypervisor/cloud-hypervisor/branches":{"post":"zVsQ7lhZzG9uN_G_J9-mhpLfjnTRSV7p6_j_8X3ax8K3KLTKlRlZ0R3q9xenOFHeV-dadY-dkhd_QIt_tXuvkQ"},"/repos/preferences":{"post":"qfb3KY0G7OkCUcTZ04iMecnq4FOFjHj653DKM9oe--fQZZZcdivd4-6zNkW0VYxNytSJJWJiiSZKMOpvEOMqNw"}}},"title":"cloud-hypervisor/docs/hotplug.md at main · cloud-hypervisor/cloud-hypervisor"}